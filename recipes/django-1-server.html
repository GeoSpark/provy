<!DOCTYPE HTML>

<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>provy - Python provisioning made simple</title>

        <link href='http://fonts.googleapis.com/css?family=Maven+Pro|Lobster&v2' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" charset="utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" charset="utf-8" />
        <link rel="stylesheet" href="../css/sh_ide-anjuta.min.css" type="text/css" media="screen" charset="utf-8" />


    </head>

    <body>
        <div class="container">
            <a name="top"></a>
            <div class="header">
                <h1 class="logo"><span class="important">Python</span>
                    provisioning made <span class="important">easy</span>!</h1>
                <p class="logo"><span class="important">provy</span> is an
                easy-to-use provisioning system in python.</p>
                <p class="logo">Turn that tedious task of provisioning the
                infrastructure of your website into a repeatable no-frills
                reliable process.</p>
                <div class="logo" onclick="window.location='http://provy.me';"></div>
                    <div class="version"><div class="ohloh" title="provy's ohloh page"><script type="text/javascript" src="http://www.ohloh.net/p/584977/widgets/project_thin_badge.js"></script></div><a class="google" href="https://groups.google.com/group/provy" title="provy's google groups page" alt="provy's google groups page"></a><a class="github" alt="provy's github page" title="provy's github page" href="https://github.com/heynemann/provy"></a><a class="python" href="http://pypi.python.org/pypi/provy/0.2.0a" alt="provy's current release" title="provy's current release"></a></div>
            </div>

            <p class="disclaimer"><em>Disclaimer: all code samples in this page are
                brought to you by <a href="http://github.com/">GitHub gists</a></em></p>

            <h2 class="title">Django + Nginx same server</h2>
            <p>In this recipe we'll be running a django website with 4 processes and 2 threads per process.</p>
            <p><a href="https://www.djangoproject.com/">Django</a>, <a href="http://gunicorn.org/">gunicorn</a>, <a href="http://supervisord.org/">supervisor</a> or <a href="http://wiki.nginx.org">nginx</a> concepts and usage are beyond the scope of this recipe.</p>
            <p>Our web server will be <a href="http://wiki.nginx.org">nginx</a> and it will be responsible for load balancing among our django processes and for serving static files.</p>
            <p>The <a href="http://en.wikipedia.org/wiki/Load_balancing_(computing)">load balancing</a> will be made using <a href="http://en.wikipedia.org/wiki/Reverse_proxy">reverse proxying</a> to the 4 gunicorn processes, that are bound to ports 8000-8003.</p>
            <p>The gunicorn processes will be monitored by supervisor. This is crucial to make sure that any process that fails is restarted.</p>
            <p>All logs are recorded in the user's home "logs" directory.</p>
            <p>Our user for this recipe is called <em>djangotutorial</em>.</p>

            <h2 class="title">The application</h2>
            <p>The application that we'll deploy is the app developed by following Django doc's tutorial.</p>
            <p>I've created a public repo at <a href="https://github.com/heynemann/django-tutorial">https://github.com/heynemann/django-tutorial</a>. This is the repository we'll use to deploy our application.</p>
            <p>It is a very simple application, but it serves us right in that it features django admin, static files and database access.</p>

            <h2 class="title">Pre-requisites</h2>
            <p>The obvious pre-requisites for our recipe is <em>provy</em>. For more instructions on how to install it, check the <a href="index.html#installing">Installing</a> section in <em>provy</em>'s main docs.</p>
            <p>In this recipe we'll be using vagrant for our <em>local</em> server and amazon ec2 for our <em>production</em> server.</p>
            <p>Using vagrant is completely optional, though. If you have a local server that you provision and deploy to, feel free to replace the address and user in <em>provyfile</em> with your own data.</p>
            <p>You'll also need an account with <a href="http://aws.amazon.com/">Amazon AWS</a>. Learning how to use Amazon EC2 is out of the scope of this recipe. If you don't have a production server and you don't expect your website to have a very big hit, Amazon has a very generous <a href="http://aws.amazon.com/free/">free tier</a>.</p>
            <p>For the purposes of this recipe, consider we have a production server running at Amazon AWS (even if at the time you are reading this the server is not online).</p>

            <h2 class="title">The deployment process</h2>
            <p>Our deployment script (fabric) will do the following steps:</p>
            <p>a. Update git's clone in the server;</p>
            <p>b. Run syncdb against the app repo in the server;</p>
            <p>c. Run collectstatic against the app repo in the server;</p>
            <p>d. Restart supervisor after everything.</p>
            <p>This should be enough to have our app up-to-date in the webserver.</p>

            <div class="footer">
                provy is free open source software - 2011
            </div>
        </div>


        <script type="text/javascript" charset="utf-8" src="../js/jquery-1.6.2.min.js"></script>
        <script type="text/javascript" src="js/sh_main.min.js"></script>
        <script type="text/javascript" src="js/sh_python.min.js"></script>

        <script type="text/javascript">
            var uvOptions = {};
            (function() {
                var uv = document.createElement('script'); uv.type = 'text/javascript'; uv.async = true;
                uv.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'widget.uservoice.com/Ky7oMC62VzFrCWRfvJvQwg.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(uv, s);
            })();
        </script>

        <script type="text/javascript">

          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-24327816-1']);
          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();

        </script>
    </body>

</html>
